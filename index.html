<!DOCTYPE html> 
<html>
  <head>
    <meta charset='UTF-8'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0'> 
    <title>editApp</title>
    <style>
    </style>
  </head>
  <body style='margin:0px; padding:0px;'>
   <script>
      var div = document.createElement('div');
      div.setAttribute('id','div');
      // div.style.setAttribute('width','1080');
      // div.style.setAttribute('height','2176');
      // div.style.setAttribute('border','solid black 1px');
      document.body.appendChild(div); 
      
      var div1 = document.createElement('div');
      div1.setAttribute('id','div1'); 
      document.getElementById('div').appendChild(div1); 
      
      var div2 = document.createElement('div');
      div2.setAttribute('id','div2'); 
      document.getElementById('div').appendChild(div2); 
	
	var div3 = document.createElement('div');
      div3.setAttribute('id','div3'); 
      document.getElementById('div').appendChild(div3); 
	  
	var div4 = document.createElement('div');
      div4.setAttribute('id','div4'); 
      document.getElementById('div').appendChild(div4); 
      
      var canvas = document.createElement('canvas');
      canvas.setAttribute('id','canvas');
      canvas.setAttribute('width','1024');
      canvas.setAttribute('height','1024'); 
      // canvas.setAttribute('border','solid black 1px');
      document.getElementById('div4').appendChild(canvas); 
    </script>
	  
	<script>
		document.getElementById('div').style = 
		'width:1080px;height:2176px;margin-left:0px;background:#E0E0E0;';
		document.getElementById('div1').style = 
			'width:1024px;height:512px;margin-left:28px;background:#E0E0E0;';
		document.getElementById('div2').style = 
			'width:1024px;height:512px;margin-left:28px;background:#E0E0E0;'; 
		document.getElementById('div3').style = 
			'width:1024px;height:128px;margin-left:28px;backgroung:#E0E0E0;';
		document.getElementById('div4').style = 
			'width:1024px;height:1024px;margin-left:28px;backgroung:#E0E0E0;';
	</script>
	  
	<script> 
		
		var touchx=0; var touchy=0; var touch=0; 
		var timer; 
		var pxlBuf = new ArrayBuffer(16*4*16*128);
                var pxlView = new Uint8Array(pxlBuf); 
		var byteBuf = new ArrayBuffer(1*2*16);
                var byteView = new Uint8Array(byteBuf); 
		for(let i=0; i<16*4*16; i+=4) { 
			pxlView[i+0] = 0xFF; // R
                        pxlView[i+1] = 0xFF; // G
                        pxlView[i+2] = 0xFF; // B
                        pxlView[i+3] = 0xFF; // A
		} 
		for(let i=0; i<1*2*16; i++) { 
			byteView[i] = 0x00; // byte
		}
	
function handleEnd(evt) { 
       evt.preventDefault();
       var ele = document.getElementById('canvas');
       var ctx = ele.getContext('2d');
       var touches = evt.changedTouches;
       var  x = touches[0].pageX; touchx = x;
       var  y = touches[0].pageY; touchy = y;
       var  tend = 3;             touch  = tend;  // touchend
      }
      canvas.addEventListener("touchend", handleEnd, false);	
	
</script> 
	
<script> 
	
window.addEventListener('beforeunload', function (e) { 
e.preventDefault(); 
e.returnValue = ''; 
}); 
	function check() { 
		var tx = parseInt(touchx)-28; 
		var ty = parseInt(touchy)-(1024+128);  
		var th = touch; 
		if(th) {    
			if(tx>=0 && tx<1024 && ty>=0 && ty<1024) { 
				clearInterval(timer); touch=0; 
				readPad(0, 0, 0); 
				timer = setInterval(f1,0020); 
			} 
		} 
	} 
	timer = setInterval(f1,0020); 
	function f1() {
		 check(); 
	}
	
	
	
</script>
	  
    <script> 
	    
      drawPad(0, 0, 0); // 2160-512 
      function drawPad(x, y, t) { 
        var px=0; var py=0; 
        var pw=0; var ph=0;
        var cl=16; var rw=16; 
        var kc=0; var kr=0; 
        var kl=2; var kt=2; 
        var kw=60; var kh=60; 
        
        var imgBuf = new ArrayBuffer(kw*4*kh*cl*rw);
        var imgView = new Uint8Array(imgBuf);
  
        var cnv = document.getElementById('canvas'); 
        var ctx = cnv.getContext('2d'); 
        var imgData = ctx.createImageData(kw, kh); 
	
        ctx.fillStyle = 'rgba(192,192,192,1.0)'; // gray
        ctx.fillRect(x, y, 1024, 1024);
        
        for (let i=0; i<(kw*4*kh*cl*rw); i+=4) { 
            imgView[i+0] = 0xFF; // R
            imgView[i+1] = 0xFF; // G
            imgView[i+2] = 0xFF; // B
            imgView[i+3] = 0xFF; // A
        }
        
        function draw(kc, kr, kw, kh, kl, kt) { 
	    var kx=x+px+(kw+kl*2)*kc; 
	    var ky=y+py+(kh+kt*2)*kr; 
	    for (let i=0; i<(kw*4*kh); i++) { 
		imgData.data[i] = imgView[kw*4*kh*(cl*kr+kc)+i]; 
	    } 
	    ctx.putImageData(imgData, kx+kl, ky+kt); 
        } 
  
        for (let j=0; j<rw; j++) { 
          for (let i=0; i<cl; i++) { 
             kc=i; kr=j; 
             draw(kc, kr, kw, kh, kl, kt); 
          } 
        }  
      } 
	    
	</script>
	  
	<script> 
		
	function readPad(x, y, t) { 
		document.getElementById('div1').innerHTML += 'touched ';  
		
		var tx=parseInt(touchx)-28; 
		var ty=parseInt(touchy)-(1024+128); 
		var th=touch;
                var px=0; var py=0; 
                var pw=0; var ph=0;
                var cl=16; var rw=16; 
                var kc=0; var kr=0; 
                var kl=2; var kt=2; 
                var kw=60; var kh=60; 
		var b=false; 
		
		var imgBuf = new ArrayBuffer(kw*4*kh*cl*rw);
                var imgView = new Uint8Array(imgBuf); 
	
                var cnv = document.getElementById('canvas'); 
                var ctx = cnv.getContext('2d'); 
                var imgData = ctx.createImageData(kw, kh); 
		
		for (let i=0; i<(kw*4*kh*cl*rw); i+=4) { 
                    imgView[i+0] = 0x40; // R
                    imgView[i+1] = 0x40; // G
                    imgView[i+2] = 0xFF; // B
                    imgView[i+3] = 0xFF; // A
                }
		
		function read(kc, kr, kw, kh, kl, kt) { 
			var kx=x+px+(kw+kl*2)*kc; 
			var ky=y+py+(kh+kt*2)*kr; 
			if(tx>kx && tx<(kx+kl+kw+pw+kl) && ty>ky && ty<(ky+kt+kh+ph+kt)) { 
				b=true; 
			} else {b=false;} 
                } 
		
		function update(kc, kr, kw, kh, pw, ph) { 
			var cb=false; var pr,pg,pb,pa; var byte; 
			for (let i=0; i<1*4*1; i+=4) { 
				pr = pxlView[4*(cl*kr+kc)+i+0]; // R 
				pg = pxlView[4*(cl*kr+kc)+i+1]; // G 
				pb = pxlView[4*(cl*kr+kc)+i+2]; // B 
				pa = pxlView[4*(cl*kr+kc)+i+3]; // A 
			} 
			if(pr==0xFF){cb=false;} 
			else if(pr==0x40){cb=true;} 
			cb=!cb; 
			if(!cb) {
	                for (let i=0; i<kw*4*kh; i+=4) { 
				imgView[kw*4*kh*(cl*kr+kc)+i+0] = 0xFF; // R
				imgView[kw*4*kh*(cl*kr+kc)+i+1] = 0xFF; // G
				imgView[kw*4*kh*(cl*kr+kc)+i+2] = 0xFF; // B
				imgView[kw*4*kh*(cl*kr+kc)+i+3] = 0xFF; // A 
			}  
			}
			else if(cb) {
			for (let i=0; i<kw*4*kh; i+=4) {
				imgView[kw*4*kh*(cl*kr+kc)+i+0] = 0x40; // R
				imgView[kw*4*kh*(cl*kr+kc)+i+1] = 0x40; // G
				imgView[kw*4*kh*(cl*kr+kc)+i+2] = 0xFF; // B
				imgView[kw*4*kh*(cl*kr+kc)+i+3] = 0xFF; // A 
			} 
			} 
			if(!cb) { 
				for (let i=0; i<1*4*1; i+=4) { 
				pxlView[4*(cl*kr+kc)+i+0] = 0xFF; // R 
				pxlView[4*(cl*kr+kc)+i+1] = 0xFF; // G 
				pxlView[4*(cl*kr+kc)+i+2] = 0xFF; // B 
				pxlView[4*(cl*kr+kc)+i+3] = 0xFF; // A 
				} 
			} 
			else if(cb) {
				for (let i=0; i<1*4*1; i+=4) { 
				pxlView[4*(cl*kr+kc)+i+0] = 0x40; // R 
				pxlView[4*(cl*kr+kc)+i+1] = 0x40; // G 
				pxlView[4*(cl*kr+kc)+i+2] = 0xFF; // B 
				pxlView[4*(cl*kr+kc)+i+3] = 0xFF; // A 
				} 
			} 
			if(!cb) { 
				byte = [0x7F,0xBF,0xDF,0xEF,0xF7,0xFB,0xFD,0xFE]; 
				if(kc>=0 && kc<8) { 
					var bt = byte[kc]; 
					var bv = byteView[1*2*kr+0]; 
					byteView[1*2*kr+0] = byte[kc] & byteView[1*2*kr+0]; 
				} 
				else if(kc>=8 && kc<16) { 
					var bt = byte[kc-8]; 
					var bv = byteView[1*2*kr+1]; 
					byteView[1*2*kr+1] = byte[kc-8] & byteView[1*2*kr+1]; 
				} 
			} 
			else if(cb) { 
				byte = [0x80,0x40,0x20,0x10,0x08,0x04,0x02,0x01]; 
				if(kc>=0 && kc<8) { 
					var bt = byte[kc]; 
					var bv = byteView[1*2*kr+0]; 
					byteView[1*2*kr+0] = byte[kc] | byteView[1*2*kr+0]; 
				} 
				else if(kc>=8 && kc<16) { 
					var bt = byte[kc-8]; 
					var bv = byteView[1*2*kr+1]; 
					byteView[1*2*kr+1] = byte[kc-8] | byteView[1*2*kr+1]; 
				} 
			}
		}
		
		function show(kc, kr, kw, kh, kl, kt) { 
			document.getElementById('div2').innerHTML += (byteView[0]).toString(16).toUpperCase() +'<br>';  
			var kx=x+px+(kw+kl*2)*kc; 
	                var ky=y+py+(kh+kt*2)*kr; 
	                for (let i=0; i<kw*4*kh; i++) { 
				imgData.data[i] = imgView[kw*4*kh*(cl*kr+kc)+i]; 
			} 
	                ctx.putImageData(imgData, kx+kl, ky+kt); 
		}
		
		for (let j=0; j<rw; j++) { 
                    for (let i=0; i<cl; i++) { 
                       kc=i; kr=j; 
                       read(kc, kr, kw, kh, kl, kt); 
                       if (b) {break;} 
                    } 
                    if (b) {break;} 
                } 
		if (b) { 
			update(kc, kr, kw, kh, pw, ph);
			show(kc, kr, kw, kh, kl, kt);
		       } 
	}
	    
    </script>
    <script>
    </script>
    <script>
    </script>
  </body>
</html>
